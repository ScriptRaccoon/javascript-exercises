<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Shortest Path - Visualization</title>

		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				background-color: black;
				color: white;
				min-height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				flex-direction: column;
				font-family: Arial, Helvetica, sans-serif;
			}

			.maze {
				margin-block: 1.5rem;
				display: grid;
				grid-template-columns: repeat(var(--cols, 0), 1fr);
				grid-template-rows: repeat(var(--rows, 0), 1fr);
				gap: 2px;
				outline: 2px solid white;
			}

			.cell {
				width: 6vmin;
				height: 6vmin;
				transition: background-color 120ms;
			}

			.cell.wall {
				background-color: white;
			}

			.cell.visited {
				background-color: rebeccapurple;
			}

			.cell.highlighted {
				background-color: hotpink;
			}

			button {
				font: inherit;
				color: inherit;
				border: none;
				background: orangered;
				padding: 0.4rem 0.8rem;
				border-radius: 0.25rem;
				cursor: pointer;
			}

			.msg {
				text-align: center;
				font-family: monospace;
			}
		</style>
	</head>
	<body>
		<button id="next_btn">Next</button>
		<div class="maze"></div>
		<div class="msg"></div>

		<script>
			function write_msg(msg) {
				document.querySelector(".msg").innerText = msg
			}

			write_msg("Click 'Next'")

			const maze = [
				[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
				[0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0],
				[0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0],
				[0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1],
				[0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0],
				[1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0],
				[0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0],
				[0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1],
				[0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0],
				[0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0],
				[0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0],
				[0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0],
			]

			const key = ([x, y]) => `${x}|${y}`

			const grid = document.querySelector(".maze")

			grid.style.setProperty("--rows", maze.length)
			grid.style.setProperty("--cols", maze[0].length)

			for (let y = 0; y < maze.length; y++) {
				for (let x = 0; x < maze[0].length; x++) {
					const cell = document.createElement("div")
					cell.classList.add("cell")
					if (maze[y][x]) cell.classList.add("wall")
					cell.id = key([y, x])
					grid.appendChild(cell)
				}
			}

			const directions = [
				[0, 1],
				[0, -1],
				[1, 0],
				[-1, 0],
			]

			const highlight_path = (path) => {
				for (const coord of path) {
					const cell = document.getElementById(key(coord))
					if (cell) cell.classList.add("highlighted")
				}
			}

			const remove_highlights = () => {
				const cells = document.querySelectorAll(".cell")
				cells.forEach((cell) => {
					cell.classList.remove("highlighted")
				})
			}

			const n = maze.length
			const m = maze[0].length

			const has_wall = ([x, y]) => maze[x][y] > 0
			const is_valid = ([x, y]) => x >= 0 && x < n && y >= 0 && y < m

			const start = [0, 0]

			const visited = new Set([key(start)])
			const end = [n - 1, m - 1]

			const queue = [[start, [start]]]

			let done = false

			function get_next() {
				if (done) return

				if (queue.length === 0) {
					write_msg("no solution")
					done = true
					return
				}

				remove_highlights()
				const [coord, path] = queue.shift()
				highlight_path(path)

				if (key(coord) === key(end)) {
					write_msg("done")
					done = true
					return
				}

				let new_coords = []

				setTimeout(() => {
					for (const [dx, dy] of directions) {
						const next_coord = [coord[0] + dx, coord[1] + dy]

						if (!is_valid(next_coord)) continue
						if (has_wall(next_coord)) continue
						if (visited.has(key(next_coord))) continue

						visited.add(key(next_coord))

						document.getElementById(key(next_coord))?.classList.add("visited")

						queue.push([next_coord, [...path, next_coord]])

						new_coords.push(next_coord)
					}

					write_msg(
						`went to ${JSON.stringify(coord)}, found ${new_coords.length ? new_coords.map((c) => JSON.stringify(c)).join(", ") : "nothing"}`,
					)
				}, 200)
			}

			const next_btn = document.getElementById("next_btn")
			next_btn.addEventListener("click", () => {
				get_next()
			})
		</script>
	</body>
</html>
